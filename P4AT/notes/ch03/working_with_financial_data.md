# 处理金融数据

## 从不同数据源读取金融数据

### 用 Python 读取 CSV 文件

Python 有一个称为 `csv` 的内置模块，该模块支持从 CSV 文件读取数据。这里介绍的第一种方法是 `reader`，将产生迭代器，每次迭代返回数据的一行，其中包含其他列表对象以及文件中的数据。

使用 `csv.DictReader` 迭代器对象而不是标准 `csv.reader` 对象使此类任务更易于管理。然后，CSV 文件中的每一行数据（除了标题行）都会作为 `dict` 对象导入，以便可以通过相应的键访问单个值。

## 高效存储金融数据

### 存储 DataFrame 对象

HDF5 二进制存储标准的 pandas HDFStore 包装器功能使 pandas DataFrame 对象的存储作为一个整体变得简单。它允许你一步将完整的 DataFrame 对象转储到基于文件的数据库对象。

使用 Python 处理 HDF5 数据库文件等二进制存储通常会让你的写入速度接近可用硬件的理论最大值。

还有另一种更灵活的方法将数据从 DataFrame 对象写入 HDFStore 对象。为此，可以使用 DataFrame 对象的 `to_hdf()` 方法并将 `format` 参数设置为 `table`。这允许将新数据附加到磁盘上的表对象，并且还允许搜索磁盘上的数据，这是第一种方法不可能实现的。付出的代价是写入和读取速度变慢。

实际上，这种方法的优点是可以使用磁盘上的 `table_frame` 对象，就像使用 pandas 在此上下文中使用的 PyTables 包的任何其他表对象一样。这提供了对 PyTables 包的某些基本功能的访问，例如将行附加到表对象：

> 使用适用于 HDF5 二进制存储标准的 HDFStore 包装器，pandas 几乎能够以可用硬件允许的最大速度写入和读取财务数据。导出为其他基于文件的格式（例如 CSV）通常是慢得多的替代方案。

### 使用 TsTable

PyTables 包是 HDF5 二进制存储库的包装器。TsTables 包又致力于基于 HDF5 二进制存储库高效处理大型金融时间序列数据集。它实际上是 PyTables 包的增强，并在其功能中添加了对时间序列数据的支持。它实现了一种分层存储方法，允许快速检索通过分别提供开始和结束日期和时间来选择的数据子集。 TsTables支持的主要场景是“一次写入，多次检索”。

### 使用 SQLite3 存储数据

金融时间序列数据也可以直接从 DataFrame 对象写入关系数据库（如 SQLite3）。在应用 SQL 查询语言来实现更复杂的分析的场景中，使用关系数据库可能会很有用。然而，在速度和磁盘使用方面，关系数据库无法与依赖于 HDF5 等二进制存储格式的其他方法进行比较。
