\chapter{计算机化的技术分析}
\section{移动平均}
移动平均（MA）反映了数据在时间窗口上的平均价格。一个 5 日 MA 显示了过去 5 天的平均价格，20 日 MA 则是过去 20 天的平均价格，以此类推。连接每天 MA 值就得到了一条移动平均线。
\begin{equation}
    \textbf{简单移动平均}=\frac{P_1+P_2+\cdots+P_N}{N}
\end{equation}
式中 $P$ 是被平均的价格，$N$ 是移动平均天数（由交易者自主决定）。

有 3 种主要的移动平均方法：简单移动平均、指数移动平均和加权移动平均。简单移动平均法曾经很流行，因为在没有电脑的时代它们容易计算，道前和哈斯特都用这种方法。但是简单移动平均有一个致命的缺陷——每一个价格都会使得移动平均值变动两次。

\subsection*{报警两次}
\begin{tcolorbox}
    首先，当一个新的价格包含进来时，简单移动平均价格会发生变动。这很好——我们想要我们的移动平均值反映最新的价格。但坏事情是我们去掉过去的一个价格时，移动平均值会再次变动。当一个高的价格去掉时，简单移动平均值就会变小。当一个低价格被去掉时，这个价格又会上升。而这些变化和现在市场的变动的真实情况毫无关系。
\end{tcolorbox}

当一个旧的数据被排除之后，简单移动平均值会发生跳跃。在较短的时间段内这种现象更加严重，但在长期移动平均中不会有明显的跳跃现象。

同时，简单移动平均值就像一个会叫两次的看门狗——当有人接近房子的时候叫一次，当有人离开的时候再叫一次。几次之后，你就不知道什么时候该相信那只狗了。

\subsection*{市场心理}
从一张照片中没法看出一个人是乐观主义者还是悲观主义者。但是如果你每天给某个人拍照片，持续十年，把照片带到实验室，将这些组合照片排序，那就可以揭示一个人的典型特征。你可以通过每天更新这些照片来追踪这个人的情绪的趋势。

移动平均就是市场的一组摄影照片——它能把几天的价格结合起来。市场由大量的群体组成，而移动平均的斜率能够辨认出大众惯性的方向。移动平均代表着股票价格在一段时间内平均一致的价值。

\important{移动平均值中最重要的信息就是其斜率的方向}。当斜率上升时，表示大众正在变得乐观——倾向于看多。它的斜率下降意味着大众开始变得悲观——倾向于看空。当价格升至移动平均值之上时，大众比之前乐观；当价格降至移动平均值之下时，大众比之前更悲观。
\subsection*{指数移动平均}
指数移动平均（以下简称EMA）是一种更好的趋势跟随指标，因为它为最近的价格分配了更大的权重而且对价格的反应也比简单的移动平均更灵敏。
同时，EMA也不会因为去掉旧的数据而发生突变。这只“看门狗”的耳朵更灵敏，而且只有当有人靠近房子的时候才会叫。
\begin{equation}
    EMA=P_{tod}\times K+EMA_{yest}\times (1-K)
\end{equation}

式中 $P_{tod}$ 是当日收盘价，$EMA_{yest}$ 是前一日指数移动平均值，$K=\frac{2}{N+1}$，$N$ 是 EMA 的天数（由交易者选定）。

相比简单 MA，EMA 有两个主要的优势。首先它为最近的交易价格分配了更大的权重。大众最近的情绪更加重要。在一个 10 日的 EMA 中，最新一个收盘价占 EMA 值比重的 18\%，但是在简单的 MA 中所有的天数所占比重都一样。其次，EMA 并不像 MA 一样简单地去掉旧的数据。旧数据是逐渐消失的，就像组合摄影中前期的照片一张张慢慢隐去的感觉。
\subsection*{选择移动平均的长度}
\important{监控 EMA 的斜率是很有益的，因为上升的斜率意味着上涨趋势，而下降的斜率意味着下跌趋势。}相对较短时间周期的 EMA 对价格变化的反应很敏感。它能够很快地抓住新趋势，但也会导致很多双重损失。双重损失是由于交易信号快速反转导致的。较长周期的 EMA 导致的双重损失比较少，但是会错过反转点后的很大一部分收益。

你可以用几种方法确定你要选择多长时间周期的移动平均或其他的指标。如果你可以发现市场价格运行的周期的话，根据市场价格运行的周期来确定 EMA 的周期长度是再好不过了。移动平均的时间周期长度应该是主要市场周期长度的一半。如果你发现市场有 22 日为一个周期的规律，就用 11 日作为移动平均的长度。如果市场周期是 34 日，就用 17 日作为移动平均的长度。麻烦的是市场的周期长度总是在变化，甚至消失。

当你想抓住长期趋势时，就用更长时间周期的移动平均。要抓大鱼就得用更坚韧的渔竿。对于想要抓住大趋势的人，可能需要使用 200 日的移动平均线。

大多数的交易者可以使用 10~30 日之间的 EMA。移动平均值一般都不短于 8 日，太短的话就违背了它们作为趋势跟随指标的目的。我喜欢 22 和 26 这两个数字，因为一个月大概有 22 个交易日，而 26 恰好是一年交易周数的一半。

为每个交易品种创造个性化系数的做法，只有当你关注很少几只股票或期货时才是可行的。一旦数量达到两位数，个性化的指标就会让人困惑。最好有个标准尺度，然后在同一个时间周期下，所有交易品种的移动平均都使用相同的时间长度。

在寻找交易机会的时候不能改变指标的时间长度。通过改变时间长度来创造出你想看到的信号恰恰会让你的指标失去其最具价值的特征——它们的客观性。最好的做法是设定一套参数，然后一直用它们。
\subsection*{交易规则}
\begin{itemize}
    \item 当 EMA 上涨时，作为多头进行市场交易。当价格下降到移动平均值附近时买入。一旦你成为多头，一定要在最近的低点下面设置保护性止损单。一旦价格接近高点时，就把保护性止损单移至盈亏平衡点。
    \item 当 EMA 下跌时，作为空头进行市场交易，当价格回升接近移动平均值时卖出，然后在最近的高点之上设置保护性止损单，当价格下跌时，将保护性止损单下移到盈亏平衡价位。
    \item 当 EMA 走平，只是小幅波动时，那意味着一种漫无目的、没有趋势的市场。这种情况下不要使用趋势跟随方法。
\end{itemize}

\begin{tcolorbox}[title=指数移动平均（EMA）]
    想通过机械方式过滤掉假突破的尝试通常会失败——过滤器减少的收益会和损失一样多。举一个过滤器的例子，制定一个规则：要求价格两次收盘于 MA 的另一侧，而不是一次；或者穿过 MA 达到一定的比例。机械方式的过滤器减少了损失，但是它们也丢失了移动平均最好的特性——它在趋势的初始阶段就锁定趋势的能力。

    交易者必须接受这样一个事实：像其他工具一样，EMA 有它好的一面也有它不好的一面。移动平均能帮助你分辨并追随趋势，但是它们也会在震荡区间内发出很多假突破信号。
\end{tcolorbox}
\subsection*{移动平均的拓展}
移动平均也能用来作为支撑位和阻力位。上升的 MA 可以作为价格的地板，而下降的 MA 可以作为价格的天花板。所以上升时，要在 MA 附近买入；
下降时，要在 MA 附近卖出。

移动平均除了用于价格上，还可以用到其他指标上。比如，有些交易者喜欢用 5 日移动平均成交量。当成交量低于其 5 日平均成交量时，意味着人们对这只股票当前趋势的兴趣在减弱，也就是说其趋势可能会反转。当成交量超过其移动平均量时，表明大众对这只股票的兴趣很强烈，因此确认了价格的趋势。

画简单移动平均的正确方法是画在滞后价格的时间长度一半距离的位置。比如，10 日简单移动平均值应该属于 10 天周期的中间位置，所以应该画在第 5 日或者第 6 日的位置。指数移动平均在最新的数据上分配了更多的权重，所以 10 日 EMA 应该画在向左移 2~3 天的位置。大多数软件都允许你设置移动平均的位置。

\warning{我觉得这里有数据前瞻的问题，不应该使用。}

指数移动平均为最新的数据分配了较大的权重，而加权移动平均（WMA，weighted moving average）允许你为任何一天分配任意的权重，取决于你觉得哪天更重要。WMA 太复杂了，所以交易者们最好使用 EMA。
\subsection*{两条 EMA 线}
我无论何时分析图表，都喜欢用两条而不是一条 EMA 线。长期 EMA 显示长期价值的连续变动，而短期 EMA 显示短期市场价值的连续变动。

记住，\important{保持两条 EMA 之间参数的比例大致为 $2:1$}。

因为短期 EMA 代表着短期内市场对价值的一致认同，而长期 EMA 代表着长期内市场对价值的一致认同，我相信价值就存在于这两条线之间。将两条 EMA 之间的空间称为\textbf{价值区间}（value zone）。

\begin{tcolorbox}[title=价格、价值以及价值区间]
    技术分析师可以通过跟踪短期 EMA 和长期 EMA 之间的差价来定义价值。其中短期 EMA 反映短期的市场价值变动，另一个长期 EMA 反映长期的市场价值变动。价值就存在于两条移动平均曲线之间（\autoref{fig22-2}）。
\end{tcolorbox}
\figures{fig22-2}{在图中上升区域之中时，你能看到有回落到价值区域，在标识为 1、2、3 和 4 点的区域附近有诱人的买入机会。慢 EMA 反转向下标志着上升趋势的结束。在图右边缘，趋势是向下的，此时拉升到价值区域（5 点的区域）是做空的好时机。}

\section{指数平滑异同移动平均线：MACD 线和 MACD 柱状线}
指数平滑异同移动平均线（moving average convergence-divergence，MACD）是以三个指数移动平均为基础，以两条曲线的形式出现在图表中，其两条线的交叉点，是一种交易信号。
\subsection{如何画出 MACD}
最初的 MACD 指标由两条线组成：一条实线（叫作 MACD 线）和一条虚线（叫作信号线）。MACD 线由两个指数移动平均（EMA）计算而来，其对价格的反应相对较快。信号线是以 MACD 线为基础，通过对 MACD 线以 EMA 的方式进行运算，实现对 MACD 线的平滑，其对价格变动的反应相对较慢。

手工做出 MACD 指标的步骤如下：
\begin{enumerate}
    \item 计算 12 日收盘价的 EMA
    \item 计算 26 日收盘价的 EMA
    \item 用 12 日收盘价的 EMA 减去 26 日收盘价的 EMA，将其差值画成一条实线，这就是较快的 MACD 线；
    \item 计算这条实线的 9 日 EMA，将其结果画成一条虚线，这就是较慢的信号线。
\end{enumerate}
\subsection*{市场心理}
MACD 线和信号线的交点表明了市场中空方和多方实力变换的平衡点。较快的 MACD 线反映的是短期内大众的心理变化，而较慢的信号线则反映了大众心理在较长期的变化。当较快的 MACD 线上升超过信号线时，表示多方主导了市场，这时候最好做多方；当较快的线落到较慢的信号线下面时，表示空方主导了市场，做空方比较有利。
\subsection*{MACD 的交易规则}
MACD 线和信号线的交叉意味着市场趋势发生了变化。顺势的方向是沿着交点的方向进行交易。这个方法产生的假突破比基于简单移动平均的方法产生假突破要少很多。

\subsection{MACD 柱状线}
相比原始的 MACD 线，MACD 柱状线能够提供更深刻的关于多空力量均衡的信息。它不仅能分辨出哪种力量处于主导地位，而且能够分辨其力量是在逐渐增强还是在减弱。MACD 柱状线是技术分析师最好用的工具之一。
\begin{equation}
    \text{MACD 柱状线}=\text{MACD 线}-\text{信号线}
\end{equation}

MACD 柱状线测量的是 MACD 线和信号线之间的差值。它将差值画为一根根柱状线——为一系列垂直的线条。

MACD 柱状线的斜率取决于相邻的两根柱状线之间的高低关系。如果后面一根柱状线比较高（就像字母“m-M”的高度关系一样），MACD 柱状线就是向上倾斜的。如果后面一根柱线图比较低（就像字母“P-p”的深度关系一样），MACD 柱状线就是向下倾斜的。
\subsubsection*{市场心理}
当较快的 MACD 线上升得比较慢的信号线快时，MACD 柱状线会上升。说明多方的力量比之前更强——这是做多的好时机。当较快的 MACD 线下降得比较慢的信号线快时，MACD 柱状线会下降，说明空方的力量在增强——这是做空的好时机。

当MACD柱状线的斜率方向和价格的变动同向时，趋势就是稳定的。\textbf{当 MACD 柱状线的斜率方向与价格的变动方向相反时，趋势的稳定程度就值得怀疑了}。

\textbf{MACD 柱状线的斜率方向比柱状线的正负重要得多}。最好是根据 MACD 柱状线的斜率方向来进行交易，因为它能告诉你在空方和多方中，到底是谁在主导市场。最好的买入信号是当 MACD 柱状线低于 0 值，而它的斜率方向是朝上的，表明空方的力量已经是强弩之末了；最好的卖出信号发生在 MACD 柱状线高于 0 值，而它的斜率方向是朝下的，表明多方已经耗尽了最后的力量。
\subsubsection*{交易规则}
\begin{itemize}
    \item 当 MACD 柱状线停止下跌开始上升时就买入，在近期的次低点下方设置保护性止损单；
    \item 当 MACD 柱状线停止上升开始下跌时就卖出，在近期的次高点上方设置保护性止损单。
\end{itemize}

MACD 柱状线在日线图中频繁地上升下降，所以每次转向都进行交易是不切实际的。在周线图上 MACD 柱状线斜率的变动更有意义。
\subsubsection*{什么时候预期市场探出新高或新低}
如果日线的 MACD 柱状线创出了三个月内的新高，说明多方的力量很强，价格还可以再创新高。如果日线的 MACD 柱状线创出了三个月内的新低，说明空方力量很强，价格可能会再次试探甚至突破之前的低点。

如果在价格上升的过程中，MACD 柱状线创出新高，说明上升的趋势是健康的，可以预期市场会继续上涨，再次试探甚至超过之前的高点；如果在价格下降的过程中，MACD 柱状线创出新低，说明空方力量很强，价格可能会再次试探甚至突破之前的低点。

MACD 柱状线就像汽车的车头灯一样——能让你看清前面的道路。需要提醒的是，虽然 MACD 柱状线不能照亮你回家的全部的路，但足以让你以适当的速度安全行驶了。
\subsubsection*{背离}
MACD 柱状线和价格出现背离的情形并不常见，但是它们却传达出了某些最强有力的信号。它们往往标志着重要的转折点。它们并不一定会出现在每个重要的顶部或底部，但是一旦你看到一个，你就知道一次大的反转可能即将到来。

\textbf{牛市背离}发生在下降趋势的终止阶段——它标志着市场底部。经典的牛市背离发生在价格和震荡指标都创出新低，开始回升，接着震荡指标穿过零点，接着价格和震荡指标又再次下降。这一次，价格跌到新的低点，但是震荡指标的底部则比前一次下跌的底部高。这样的背离经常发生在猛烈的上涨之前。

\begin{tcolorbox}
    要注意，两个底部之间有一个穿越回 0 值线的部分是真正的背离所必须具备的因素。在第二次探底之前，MACD 柱状线必须穿越回 0 值线。如果没有与 0 值线的交点，那就不是真正的背离。
\end{tcolorbox}
\figures{fig23-3}{道琼斯工业平均指数（DJIA）周线图，26 日和 13 日指数移动平均线，12-26-9MACD 线和柱状图。这里你看到的背离信号标志的是 2007~2009 年期间熊市的底部。这个背离信号在低点附近给出了非常强烈的买入信号。在 A 区域，当时雷曼兄弟破产了，一浪接一浪的卖出冲击着市场，道琼斯指数像自由落体一样下跌。MACD 线柱图创出历史新低，说明空头极端强大，A 区域的底部价格很可能会被重新试探甚至突破。在 B 区域，MACD 线柱图反弹到 0 值线之上，“打破了这个熊市”。要注意这个短暂的反弹触及到了两条移动平均线之间的“价值区间”——这是熊市反弹时一个比较常见的目标。在区域 C，道琼斯指数滑向了一个新的熊市低点，但 MACD 柱状线的底部则浅得多。而之后的回升，完成了一次牛市背离，这是非常强烈的买入信号。}

\textbf{熊市背离}发生在上涨趋势中——意味着市场的顶部。经典的熊市背离发生在价格创出新高后回落的时候，同时震荡指标落到0值以下。价格逐渐平稳，然后上升到新高，但是震荡指标仅上升到比之前的峰值要低的高点。这样的熊市背离通常预示着剧烈的下跌。

熊市背离显示出多方的能量在耗尽，价格还在惯性上涨，但空方已经准备入场接手。有效的背离很容易被看出来——它们就像从图表中跳到你眼前一样。如果你需要用尺子来量一量看这是不是一个背离，那么你可以假定它不是。

\figures{fig23-4}{道琼斯工业平均指数（DJIA）周线图，26 日和 13 日指数移动平均线，12-26-9MACD 线和柱状图。在 X 区域，道琼斯指数和其 MACD 柱状线同时上升到牛市的新高点，说明多头的力量十分强大。这意味着未来很有可能会再次试探甚至突破顶部 X 点的价格。注意，MACD 柱状线的X部分，其形态很复杂，但并不是一个背离，因为它的中间部分并未沉到 0 值线之下去。在 Y 区域，MACD 柱状线跌落到 0 值线之下了，“打破了这个牛市”。要注意，价格穿透到了两条移动均线之间的“价值区间”的下方。这是牛市中断时一个相当普遍的信号。同样要注意到在底部 Y 处，有一个“袋鼠尾”。在 Z 区域，道琼斯指数上升到一个牛市新高，但 MACD 柱状线的上升有点缺乏活力，反映出牛市的虚弱。在峰值 C 处开始的跳水，完成了熊市背离，给出了强烈的卖出信号，预示着近 30 年最严酷的一个熊市。}

\textbf{这里的新高是历史新高还是阶段新高？}

“无右肩”背离（“missing right shoulder”divergences）是指，当第二次探新高时MACD柱状线还没有穿过0值。这种情况很罕见，但是是非常
强烈的信号。这在一本叫作《未选择的路：背离交易》（Two Roads Diverged:Trading Divergences）的电子书中有详细的描述和说明。

\textbf{三重牛市或熊市背离}由三组价格和震荡指标的底部或者三组价格和震荡指标的顶部组成。它们比普通的背离更加强烈。要产生三重背离，普通的牛市背离或者熊市背离首先要出现失效。这也是需要做好审慎的资金管理的又一个理由！如果你在假突破时只损失了一小部分钱，那你能保持充足的资金和良好的心态再次入场交易。震荡指标第三次探顶或者探底一定比第一次浅，但并不一定要比第二次浅。
\subsubsection*{巴斯克维尔的猎犬}
这个信号产生在，当可信赖的图表或者指标的模式出现，但价格并没有走向你期望的方向时。比如，当背离模式出现，显示上升的趋势可能要结束了，但是价格却还在持续上涨，这种情形称为“巴斯克维尔的猎犬”。

当市场对一个完美的信号无动于衷时，那就是“巴斯克维尔的猎犬”的信号。这就表示在表象之下有更基础的东西在发生变化。这时候要做好准备，迎接一波新的大趋势。

我并不是抛物线止损指标（stop and reverse）的拥趸，但“巴斯克维尔的猎犬”是个例外。在某些罕见的场合中，当熊市背离失效时，我会做多。同样，在牛市背离失效的罕见机会里，我会卖空。
\section{趋向系统}
\subsection*{如何构建趋向系统}
趋向运动可以定义为，今天价格波动区间超出前一天波动区间的比例。趋向系统能够检查出今天的波动区间是高于还是低于前一日的区间，然后将一段时间区间内的数据进行平均。
\begin{enumerate}
    \item 确定“趋向运动”（directional movement，DM）：比较今天和昨天交易价格波动区间。趋向运动是今天的交易波动区间超过昨天交易波动区间的最大值。有四种类型的趋向运动（\autoref{fig24-1}）。趋向运动总是非负数（+DM和-DM仅仅表示今天的波动区间是高于还是低于昨天的区间）。
    \item 确定市场的“真实波幅”（true range，TR）。$TR$ 总是正值，它是
          以下三者中的最大值：
          \begin{enumerate}
              \item 今天价格最高价与最低价之间的差值
              \item 今天价格最高价与昨天收盘价的差值
              \item 今天价格最低价与昨天收盘价的差值
          \end{enumerate}
    \item 计算每日“趋向指数”（directional indicators，$+DI$ 和 $-DI$）。通过计算 $DM$ 占 $TR$ 的百分比——从而可以比较各个不同市场的趋向指数大小。每个 $DI$ 都是正值：当市场在某天没有向上的趋向运动时，$+DI$ 等于零；当某天市场没有向下的趋向运动时，$-DI$ 等于零。
          $$+DI=\frac{+DM}{TR}, -DI=\frac{-DM}{TR}$$
    \item 计算“平滑趋向线”（smoothed directional indicators，$+DI_{13}$ 和 $-DI_{13}$ ），通过移动平均来平滑 $+DI$ 和 $-DI$。大多数软件包能够让你随意选择需要平滑的时间段，比如 13 日的移动平均。你能得到两条指标线：正的和负的平滑趋向线， $+DI_{13}$ 和 $-DI_{13}$ 。两者的数值都是正值，一般用不同的颜色标注。

          正平滑趋向线和负平滑趋向线的关系能够确定趋势。当 $+DI_{13}$ 在上面时表示趋势是向上的，当 $-DI_{13}$ 在上面时，就说明趋势是向下的。$+DI_{13}$ 和 $-DI_{13}$ 的交点就释放出了买入或者卖出的信号。
    \item 计算“平均趋向指标”（average directional indicator，ADX）。这个指标是趋向系统独特的组成部分，它能显示什么时候趋势是值得我们参与的。ADX 测量了 $+DI_{13}$ 和 $-DI_{13}$ 之间的价差。由以下两步进行计算得。
          \begin{enumerate}
              \item 计算日线趋向指标 DX：
                    $$DX=\frac{(+DI_{13})-(-DI_{13})}{(+DI_{13})+(-DI_{13})}$$
              \item 通过移动平均来平滑 DX，计算得到平均趋向指标 ADX。例如可以通过 13 日 EMA 来进行平滑。
          \end{enumerate}
\end{enumerate}
\figures{fig24-1}{趋向运动。趋向运动是当日交易区间超过前一日交易区间的最大值。如果当日的交易区间延伸高于前一日区间，趋向运动为正（$+DM$）。如果当日的交易区间延伸低于前一日区间，趋向运动为负（$-DM$）。如果当日交易区间被包含在前一日区间之内，或者包含前一日区间但延伸高于和低于前一日区间的幅度相等，此时没有趋向运动（$DM=0$）。如果当日区间包含前一日区间但延伸高于和低于前一日区间的幅度不相等，视哪一部分幅度更大，决定 $DM$ 为正或负。在涨停日，$+DM$ 为当日收盘价与前一日高点之间的距离。在跌停日，$-DM$ 为当日收盘价与前一日低点之间的距离。}

在趋势持续的区间，如果两条平滑趋向线之间的差值增大，ADX 则会上升；当趋势反转或者市场进入了震荡区间时，ADX 则会下降。在 ADX 值上升时，最好只用趋势跟随指标。
\subsection*{群体行为}
通过测量多空双方使今天价格波动区间超出昨天的程度，趋向系统能够跟踪群体看多和看空的变化。如果今天比昨天的高点要高，那么市场群体对市场的情绪更趋向于乐观。如果今天比昨天的低点更低，则表示市场群体的情绪更趋向于悲观。

通过趋向线的相对位置能够识别出趋势。当 $+DI_{13}$ 在 $-DI_{13}$ 之上时，表示多方力量主导市场。当 $-DI_{13}$ 升高超过 $-DI_{13}$ 时，表示交易者中，空方力量更强。根据较高的趋势线判断多空主导力量的方式进行交易比较有利。当两条趋向线的距离增大时，ADX会增大，表示市场的主导力量——比如上涨牛市中的多头——正在变强，而较弱的一方在变弱，所以趋势很可能会持续。

当两条趋向线的距离变窄时，ADX 会下跌，表示市场的主导力量正在变弱，而之前较弱的一方正在变强。这说明市场将要反转，因此最好不要使用趋势跟随工具进行交易。
\subsection*{交易规则}
\begin{itemize}
    \item 当 $+DI_{13}$ 于 $-DI_{13}$ 时，做多头；当 $-DI_{13}$ 高于 $+DI_{13}$ 时，做空头。同时，ADX上升的时候是最佳的交易时机，表示主导力量正在增强。
    \item 当 ADX 下降时，表示市场的趋势正在减弱。这时可能产生很多假突破。当 ADX 下降时，最好不要用趋势跟随指标。
    \item 当 ADX 降到两条趋向线之下时，表示市场是平静、死气沉沉的。此时不要用趋势跟随系统交易。但要做好交易的准备，因为这是暴风雨之前的平静，大趋势将会从这种平静中出现。
    \item 当 ADX 落到两条趋向线之下时，则出现了趋向系统的最佳信号。它在此区域待得越久，那么下一次趋势的基础就越强。当 ADX 从两条趋向线下方开始回升时，意味着市场从平静中觉醒了。那表示新的牛市或者熊市正在形成，到底是熊市还是牛市取决于在上面的是哪条趋向线。
    \item 当 ADX 回升超过两条趋向线时，表示市场过热了。当 ADX 从高于两条趋向线的地方掉头向下，表示主要的趋势受到了阻碍，这正是趋势交易兑现利润的好时机。如果你是重仓的话，一定要先兑现一部分利润。
\end{itemize}
\figures{fig24-2}{低位 A 点的价格是 3.07 美元，股价在 B 点跌到 3.01 美元后开始反弹，形成一个向下假突破。股价在 C 点跌到 3.08 美元，重新试探了支撑位——股价从此处开始启动了，指数移动均线转头向上。趋向系统在图中绿色垂直箭头所示位置发出了买入信号：绿色牛市趋向线在红色熊市趋向线之上，同时 ADX 穿透到红线上方。你或许发现了图中字母区域也发现了类似的做空信号，但一名严谨的交易者不会对每个见到的信号都去交易：在 3 美元价格附近做空一只从 45 美元掉下来的股票，意味着去追已经严重老化的趋势。在右边缘附近，你能看到价格回落到价值区间，提供了很好的多头加仓时机。}
\subsection*{平均真实波幅——来自波动率的帮助}
平均真实波幅（ATR）是真实波幅（TR，在“如何构建趋向系统”一节提及过）在某一时间段内的平均值，常用的为 13 日均值。因为波动率是交易的重要指标，你可以通过画出一系列高于或者低于移动平均值的ATR线来追踪波动率的变化。
\subsection*{ATR 通道线}
\begin{description}
    \item[入场点]在“移动平均”那一节中，我们知道在价格低于价值的时候买入——低于EMA的时候，是一个好主意。但是要低于价值多远的距离？如果是普通回调往往会在负一倍的 ATR 处见底。
    \item[保护性止损位]最好让你的保护性止损位在至少离入场点一倍 ATR 距离的地方。如果小于这个距离，会让你的保护性止损价位落入市场噪音区间之中，很可能被短期的随机波动所触及。所以把你的保护性止损位设置得远一点，使得只有真正的反转才能触及你的保护性止损单。
    \item[盈利目标]你买入一只股票之后，可以根据那只股票的强势程度，在 1 倍、2 倍甚至 3 倍 ATR 的位置，来设置你兑现利润的止盈价位。
\end{description}

在任何市场中，长时间价格波动超过 3 倍 ATR——3 倍的平均真实波幅——都非常少见。这通常意味着行情非常极端。无论何时你看到市场波幅超出 3 倍 ATR 之外，不论是上升还是下跌，你都有理由相信会出现一波回调。
\section{震荡指标}
趋势跟随指标能帮助我们辨认趋势——比如 MACD 线或者趋向系统，而震荡指标则能帮助我们抓住反转点。

震荡指标能识别市场大众的极端情绪，能够帮助你发现市场中乐观或悲观情绪难以持续的价位。专业交易者总会逆着极端情绪而来，他们会在衍生品上对赌价格将回归理性。当市场上涨，大众由于贪婪而激动地高喊，争先恐后地追随着市场时，专业交易者已经开始准备卖空了。当市场下跌，大众陷入恐慌时，专业交易者则已经准备好买多了。震荡指标能帮我们找到这样的交易时机。
\subsection*{超买和超卖}
超买意味着市场点位太高，随时可能回调。当震荡指标到达前期的高位水平时，就形成了超买。超卖意味着市场点位太低，随时可能反弹。当震荡指标到达前期的低位水平时，就形成了超卖。

一定要记住，这些高低位水平并不是绝对的。当一波强力的上升趋势开始后，震荡指标可以持续几个星期的超买状态，这样给出的卖出信号是过早的。同样，在急剧的下跌趋势中，也可能保持几周的超卖状态，这样给出的买入信号是过早的。

\begin{tcolorbox}
    我们可以通过水平参考线来标记超买和超卖的震荡指标。我们选择画线的位置时，应该使得在过去 6 个月的震荡指标仅最高点和最低点超出线段之外。画这些线的正确方法是让震荡指标只有 5\% 的时间超出这些线之外。每 3 个月重新调整线的位置。
\end{tcolorbox}

MACD 柱状线是趋势跟随指标。
\section{随机指标}
随机指标考察的是每个收盘价和最近的高低价区间之间的关系。它由两条线组成：快速线 \%K 和慢速线 \%D。
\begin{enumerate}
    \item 计算随机指标的第一步是计算“原始随机指标”或者叫 \%K：
          $$\%K=\frac{C_{tod}-L_n}{H_n-L_n}\times 100$$
          式中，$C_{tod}$ 今日收盘价，$L_n$ 是指 $n$ 个交易日中的最低价，$H_n$ 是指 $n$ 个交易日中的最高价，$n$ 交易者所选定的，计算随机指标所用的交易日天数。

          随机指标的标准时间跨度是5天，虽然有些交易者会用更多的天数。短的时间周期能帮你抓住更多的转折点，但较长的时间周期却能帮你识别出比较重要的转折点。
    \item 计算 \%D。可以通过平滑 \%K 来得到——通常按 3 天周期来平滑。可以通过很多方法做到这一点，比如：
          $$\%D=\frac{\text{3 日 }(C_{tod}-L_n)\text{之和}}{\text{3 日 }(H_{n}-L_n)\text{之和}}$$
\end{enumerate}

有两种随机指标——快速随机指标和慢速随机指标。\textbf{快速随机指标}由两条线组成——画在同一张图表中的 \%D 和 \%K。它很灵敏但会导致许多双重损失。许多交易者更青睐在快速随机指标中再增加一层平滑，得到\textbf{慢速随机指标}。快速随机指标中的 \%D 线就成为慢速随机指标中的 \%K 线，然后重复步骤 2 来平滑，得到慢速随机指标中的 \%D 线。慢速随机指标能够更好地过滤掉市场噪声，并且导致的双重损失也较少。

\figures{fig26-1}{这张雪佛龙公司（CVX）的图表展现出随机指标既有有利的一面，也有危险的一面。只要股票在横向盘整区间之中——图中大部分时间都是如此，随机指标能明确标出短期高点和底部。当随机指标上升到下参考线之上时，给出买入信号（以绿色垂直箭头标示）；当随机指标下降到上参考线之下时，给出卖出信号（以红色垂直箭头标示）。随机指标宽的、向下倾斜的顶部强化了这些卖出信号（以紫色斜箭头标示）。图中有多个假突破，这些也强化了随机指标的信号。在震荡区间使用随机指标信号就像用自动取款机一样。当趋势突然脱离震荡区间，这台机器会失效并且吞掉你的银行卡。在图表右边缘附近，一个急剧的下跌趋势践踏了随机指标的买入信号。交易者在震荡区间内可能依靠随机指标交易，但必须使用保护性止损位，因为震荡区间内的最后一笔交易往往会在趋势开始时造成损失。}

随机指标的取值范围是 0-100。通常在 20\% 和 80\% 的地方画参考线，标识出超买和超卖的区域。
\subsection*{大众心理}
任何时期价格的最高点都表示了那一时期多方最强的力量。同样，那段时期价格的最低点也表示了当时空方最强的力量。

随机指标计算的是多方或空方使价格收在一段时期内价格高点或低点附近的程度。当在价格上升趋势中时，价格往往收在最高点附近。如果多方能在盘中将价格推高，但是收盘时无法使价格收在高点附近，随机指标就会转向为下跌。这表明多方力量并没有看起来那么强，因此是卖出的信号。

在价格下降的趋势中，收盘价往往是在最低点附近。如果当期线柱反而收在其高点附近，表明空方只能把价格暂时打压下来，却不能让价格保持在低位，随机指标就会转向为上涨。随机指标向上转折表明空方的力量并没有看起来那么强大，因此是买入的信号。
\subsection*{交易规则}
随机指标能够显示出多方或空方在什么时候变强或变弱。你能根据这个来判断多方或空方谁将赢得眼前战役的胜利。与胜利者同向交易、与失败者逆向交易比较有利。

随机指标能够给出三种类型的交易信号，按照其重要程度从大到小依次为：背离、随机指标线的位置及其方向。
\subsubsection*{背离}
随机指标最强烈的买入或卖出信号为该指标和价格出现背离。
\begin{itemize}
    \item 牛市背离发生在当价格下跌到新低，但随机指标的低点却比前一个低点位置高时。这说明空方力量在减弱，价格只是惯性下跌了。一旦随机指标从其低点位置开始掉头向上时，就是强烈的买入信号：此时可以买入并在价格的最新低点之下设置一个保护性止损单。\important{最好的买入信号为，随机指标的第一次底部低于下参考线而第二次底部高于下参考线。}

    \item 熊市背离发生在当价格上涨到新高，但随机指标的顶部高度却低于前一个顶部的高度。它表明多方力量在减弱，价格只是惯性上涨了。一旦随机指标从其第二次顶部位置开始掉头向下时，就是强烈的卖出信号：此时可以做空并在高于最近顶部的位置设置一个保护性止损单。\important{最好的卖出信号为，随机指标在第一次顶部高于上参考线而第二次顶部低于上参考线。}
\end{itemize}
\subsubsection*{超买和超卖}
当随机指标上涨超过其上参考线时，表明市场超买了。它表明股票甚至是整个市场都处于不可持续的高点而且已经做好回调的准备了。当随机指标落到其下参考线以下时，表明股票甚至整个市场都处在超卖的阶段，此时市场价格太低了，已经随时准备好上涨。

\important{上面这些信号在市场处于震荡区间时很有效，但当市场形成趋势时是失效的。}在上涨趋势中，随机指标会很快到达超买位置，会持续给出卖出的信号，但市场会一直上涨。在下降趋势中，随机指标会很快到达超卖位置，持续给出错误的买入信号。因此最好把随机指标和长期的趋势跟随指标（见第39节）结合起来使用。

\begin{itemize}
    \item 当你在周线图中识别出上升趋势时，等到日线图中随机指标降到其下参考线下方时，不用等到随机指标曲线相交或者掉头向上，就可以在最近一根柱线的最高价上方挂买单。一旦成交为多头，在今天的价格低点和前一交易日价格低点二者中取较低值，然后在这一价格下方位置设置保护性止损单。

          随机指标的底部形态通常预示着这波上涨是强是弱。如果底部又窄又浅，就表明空方力量比较弱，上升的势头可能比较强。如果底部又深又宽，表明空方力量很强，这波上涨可能很弱。最好还是只采用那些强烈上涨形态的买入信号。
    \item 当你在周线图中识别出下降趋势时，等到日线图中随机指标上升超过其上参考线时，不用等到随机指标曲线相交或者掉头向下，在最近一根柱线的最低价的下方挂卖单。到随机指标曲线相交时，市场通常已经处在自由落体式下跌中了。一旦成交为空头，在当日或前一交易日价格的高点位置上方设置一个保护性止损单。

          随机指标的顶部形态通常预示着下降的趋势是陡峭还是缓慢。随机指标顶部很窄，表明多方力量很弱，可能会有剧烈的下跌。而随机指标的顶部又高又宽，则表明多方的力量比较强——最好还是忽略此时的卖出信号。
    \item 当随机指标超买时不要买入，当它超卖时也不要卖出。这条法则能过滤掉大部分的错误交易。
\end{itemize}
\subsubsection*{随机指标线的方向}
当两条随机指标线都向同一方向运动时，肯定了短期的趋势。当价格升高的同时两条随机指标线上升时，上升的趋势可能会继续。当价格下跌的同时两条指标线也下跌时，短期下降的趋势可能会继续。
\subsection*{随机指标的拓展}
你可以在任意的时间周期下使用随机指标，包括周度、日度或者日内。周度随机指标通常在 MACD 柱状线之前的一周改变其方向。如果周度随机指标转向了，就警告你 MACD 柱状线可能要在下周转向了——这时候就该在现有的仓位上用偏紧的保护性止损单或兑现利润。

选择随机指标的时间周期是很重要的。短期的震荡指标更敏锐。而长期的震荡指标只有在重大的顶部或者底部出现时，才会发生转折。如果你把随机指标当成一个独立的震荡指标使用，那么长期性指标更有用。如果你把随机指标当成你的交易系统的一部分，把它和其他趋势性指标结合起来，那么短期性指标更有用。
\section{相对强弱指标}
相对强弱指标（RSI）通过监测任意一种交易产品的收盘价变动来测量其强度。它是一个先行或者同步指标——从不滞后。
\begin{equation}
    \begin{aligned}
        RSI & =100-\frac{100}{1+RS}                                  \\
        RS  & =\frac{\text{选定期间内上涨收盘价的平均涨幅}}{\text{选定期间内下跌收盘价的平均跌幅}}
    \end{aligned}
\end{equation}

RSI 的波动区间是 0-100。当它到达顶点开始下降时，就确定了市场价格的顶部。当它下跌然后开始掉头向上时，就确定了一个底部。RSI 底部和顶部的模式不会随着时间跨度增大而有所改变。交易信号在短期内的 RSI 上看得更清楚，比如 7-9 天的 RSI 。
\figures{fig27-1}{相对强弱指标仅仅基于收盘价，相比随机指标其噪声较小。当其上升到下参考线之上时，预示要上涨（图中以绿色垂直箭头标示）；当其下跌到上参考线之下时，预示要下跌（图中以红色垂直箭头标示）。比较两张图表，你能发现相对强弱指标的信号出现要早一些。图中以倾斜实线箭头和虚线红色箭头标出的是相对强弱指标出现熊市背离给出的非常强的卖出信号。股价上升到新高，但相对强弱指标并没有触及其上参考线，显示这次上涨隐藏着的虚弱。图中右边缘处的尖锐跳空，不顾相对强弱指标发出的买入信号，将价格推向更低位。要避免受到伤害，我们必须使用保护性止损位，因为震荡区间里最后一笔交易，很容易在新趋势开始时造成亏损。}

水平参考线一定要能够穿过 RSI 的最高点和最低点。使用 5\% 法则：每一条线都要保证 RSI 在过去的 4-6 个月中，位于参考线之上的时间少于 5\%。每 3 个月就调整一次参考线。
\subsection*{交易规则}
RSI能够提供三种类型的交易信号。按照其重要程度排列分别是：背离、图形模式以及RSI水平。

\subsubsection*{牛市和熊市背离}

RSI 和价格的背离往往发生在重要的顶部和底部。它们表明趋势什么时候变弱并且准备反转了。
\begin{itemize}
    \item 牛市背离发出买入信号。当价格创出新低，而 RSI 指数的底部比其前一次下跌的底部要高。一旦 RSI 从第二次底部开始上扬，马上可以买进并且在近期底部的价格最低点的下方设置保护性止损单。如果 RSI 指数的第一次底部低于下参考线，而第二次底部高于下参考线，那么这就是一个非常强烈的买入信号。
    \item 熊市背离发出卖出信号。当价格上涨创出新高，但是 RSI 的顶部却低于其前一次上涨的顶部的时候。一旦 RSI 从第二次顶部下跌就马上可以卖空，同时在最近的新高价上方设置保护性止损单。如果第一次 RSI 顶部超过了上参考线而第二次的顶部低于上参考线，那么卖出的信号就非常强烈。
\end{itemize}
\subsubsection*{图表的模式}
RSI 通常比市场价格早几天突破阻力位或者支撑位，表现出了趋势可能要改变的迹象。RSI 趋势线通常会比价格趋势线早 1-2 天被反转。
\begin{itemize}
    \item 当 RSI 的下降趋势反转时，在最近的价格高位上挂一个买单来抓住这
          一次向上的突破；
    \item 当 RSI 的上升趋势反转时，在最近的价格低位上挂一个卖单来抓住这
          一次向下的突破。
\end{itemize}
\subsubsection*{RSI 水平}
当 RSI 上升超过其上参考线时，表明多方很强势，但是市场已经超买了而且已经进入了应该卖出的区域。当 RSI 下跌到其下参考线以下时，它表明空方力量很强，但是市场已经超卖了而且已经进入了应该买入的区域。

只有当周趋势上涨时，根据日线 RSI 指标发出的买入信号进行买入才比较有利。同样地，只有当周趋势是下降时，根据日线 RSI 指标发出的卖出信号进行卖出才比较有利。
\begin{itemize}
    \item 当 RSI 击穿其下参考线，又回升到下参考线上方时买入。
    \item 当 RSI 上升到上参考线上方，又回落到上参考线下方时卖出。
\end{itemize}